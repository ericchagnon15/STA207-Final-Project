---
html_document:
  df_print: paged
author: "Eric Chagnon"
date: 
output:
  html_document:
    df_print: paged
geometry: margin = 0.5in
header-includes:
- \usepackage{booktabs}
- \usepackage{longtable}
- \usepackage{array}
- \usepackage{multirow}
- \usepackage{wrapfig}
- \usepackage{float}
- \usepackage{colortbl}
- \usepackage{pdflscape}
- \usepackage{tabu}
- \usepackage{threeparttable}
- \usepackage{threeparttablex}
- \usepackage[normalem]{ulem}
- \usepackage{makecell}
- \usepackage{xcolor}
title: "STA 207 Project (Title TBD)"
keep_tex: no
number_sections: no
editor_options:
  chunk_output_type: console
subtitle: 
documentclass: article
urlcolor: blue
---
  
<!-- The above is set to automatically compile to a .pdf file.   -->
<!-- It will only succeed if LaTeX is installed. -->
  
<!-- If you absolutely can't get LaTeX installed and/or working, then you can compile to a .html first,  -->
<!-- by clicking on the arrow button next to knit and selecting Knit to HTML. -->

<!-- You must then print you .html file to a .pdf by using first opening it in a web browser and then printing to a .pdf -->


```{r setup, include=FALSE}
# This is the setup chunk
#  Here you can set global options for the entire document

library(knitr) # I recommend doing this here
library(ggplot2)

# Although you can call functions from a library using the following notation
#  without loading the entire library.
knitr::opts_chunk$set(echo = TRUE, 
                      comment = NA, # Required
                      fig.path = "./figures/",  # Store all figures here in relative path (make the folder first)
                      fig.align = "center",
                      fig.width = 7,
                      fig.height = 7,
                      message = FALSE, # Turn off load messages
                      warning = FALSE # Turn off warnings
                      )

```

\clearpage

```{r include=FALSE}
library(ggplot2)
setwd("~/Downloads")
data = read.csv("final_data.csv")
# You should not echo this chunk.
# include=FALSE does more than echo=FALSE, it actually does: echo=FALSE, results='hide', message=FALSE, warning=FALSE, fig.show='hide'

# You should set your working directory at the very beginning of your R Markdown file
# setwd("~/Dropbox/teaching/FA2020/CMDA_4654/homework/homework1/")

# In linux ~/ is shorthand for /home/username/
# You should type things out properly for your system
# Mac: /Users/username/Documents/CMDA4654/Lectures/Lecture_03/.../
# Windows: C:/Users/username/Documents/etc/Lecture/Lecture_03/.../


```




# Abstract 

## TODO

\pagebreak

# Introduction
The Coronovirus pandemic that started in 2019 has had a lasting impact on the world. As of writing this report over 5.9 million people lost their lives to the Coronavirus, better known as Covid-19. Covid-19 affected each country differently, this could be due to a multitude of things like vaccination rates, differences in mandated public health policies, public opinion on Covid-19, etc. The goal of this paper is to try and determine how well a country protected its citizens from the pandemic by analyzing countries' health metrics. In order for large and small countries to be compared more fairly, the response variables used will be the percentage of the country's population that died from Covid-19, and the predictor variables will be Gross National Income (GNI), and the Literacy Rate.

# Background

The data sources for this project consist of the World Health Organization (WHO), the World Bank, and the Central Intelligence Agency (CIA). The WHO maintains a Covid-19 dashboard that updates daily cases and deaths for countries around the world and keeps a count of cumulative deaths and cases starting from January 3, 2020. The CIA maintains a dataset for metrics of individual countries such as GPD, Area, Net Migration, etc. and is available on Kaggle. Finally, every year the World Bank updates a dataset containing the GNI of individual countries. 

# Descriptive Analysis
A moderate amount of data cleaning is required to obtain the final dataset. In order to obtain the response variable the Cumulative Deaths of each country from the WHO dataset is divided by the country's Population from the CIA dataset. This provides a percentage of the population that had Covid-19 related deaths. Secondly, the GNI of each country from the World Bank dataset, the Literacy Rate from the CIA dataset, and the new response variable need to be joined together via an inner join on the country name. After removing NA values, the final amount dataset contains 157 countries. The GNI treatment effect was split into four categories: Low, Medium-Low, Medium-High, and High as per (Hamadeh, et. al, 2020), and the Literacy Rate was spliting into three categories: Low, Medium, and High as per (World Population Review, 2022). The amount of countries in each level of GNI and Literacy rate can be seen in the table below:

```{r, echo=FALSE, warning=FALSE}
table(data$gni, data$literacy)
```

The literacy rate was split into three categories: Low, Medium, and High. The distributions of the GNI and the Literacy Rates of each country can be seen in the figures below.


```{r, echo=FALSE}

ggplot(data=data, aes(x = gni, y = percentDead, fill = gni)) + geom_boxplot() + ggtitle("Figure 1: Percentage Dead by GNI")

ggplot(data=data, aes(x = literacy, y = percentDead, fill = literacy)) + geom_boxplot() + ggtitle("Figure 2: Percentage Dead by Literacy Rate")

```

From the above Figures it seems as though the countries with Low GNI and Low Literacy rate have the smallest mean of Percentage of Population Deaths. 

# Predictive/Inferential Anaysis
In order to determine the effects of GNI and Literacy rate on the Percentage of Population Deaths, and two-way ANOVA model was constructed with the form:
$$Y_{i,j,k} = \mu + \alpha_i + \beta_j + (\alpha\beta)_{ij} + \epsilon_{i,j,k}, i = 1,...,4, j = 1,..,3, k = 1,2,...,n_{i,j}$$
Where $\alpha_i$ satisfies $\Sigma^{4}_{i=1}\alpha_i=0$, $\beta_j$ satisfies $\Sigma^{3}_{j=1}\beta_j=0$, $\Sigma^4_{i=1}(\alpha_i\beta_j) = 0$, $\Sigma^3_{j=1}(\alpha_i\beta_j) = 0$ and $\epsilon_{i,j,k}$ are i.i.d $N(0,\sigma^2)$.

In this model $\mu$ is the average Percentage of a county's population that died to Covid-19, $\alpha_i$ is the main effect of GNI, and $\beta_j$ is the main effect of Literacy Rate.


```{r, echo=FALSE}
aov.fit = aov(data = data, percentDead ~ gni + literacy)
anova(aov.fit)
```

Here it is evident that the Literacy Rate does not have a significant effect. So removing it from the model yields the following: 

```{r, echo=FALSE}
aov.fit2 = aov(data = data, percentDead ~ gni)
anova(aov.fit2)
```



# Sensitivity Analysis

The above model has the following diagnostic plots.
```{r, echo=FALSE}
par(mfrow=c(2,2))
plot(aov.fit2)
par(mfrow=c(1,1))
```

The Normal Q-Q plot shows that the approximate normal distribution of errors assumption may be violated. A Levene Test was carried out with $H_0: E[d_1] = E[d_2] = ... = E[d_r]$ where $d_r = |Y_{ij} - \bar{Y_i}|$.

```{r}
data$res.abs = abs(aov.fit2$residuals)
summary(aov(res.abs~percentDead, data=data))
```

Since the test statistic has a p-value $<2e16$ there is sufficient evidence to reject $H_0$, and conclude that the errors are not from the same distribution.

# Conclusion

Since the assumptions required for ANOVA are violated another approach should be taken in order to determine the relationship between GNI and Percentage of Population that died. 

# Refrences 

World Health Organization. (n.d.). Covid-19 Dashboard. World Health Organization. Retrieved March 4, 2022, from https://covid19.who.int/table 

GNI per capita, Atlas method (current US$). Data. (n.d.). Retrieved March 4, 2022, from https://data.worldbank.org/indicator/NY.GNP.PCAP.CD 

Abhishek252. (2021, April 14). CIA country dataset for unsupervised learning. Kaggle. Retrieved March 4, 2022, from https://www.kaggle.com/abhishek252/cia-country-dataset-for-unsupervised-learning 

Hamadeh, N., Van Rompaey, C., &amp; Metreau, E. (2021, July 1). New World Bank country classifications by Income Level: 2021-2022. World Bank Blogs. Retrieved March 4, 2022, from https://blogs.worldbank.org/opendata/new-world-bank-country-classifications-income-level-2021-2022

World Population Review. Literacy Rate by Country 2022. Retrieved Mar 4, 2022, from https://worldpopulationreview.com/country-rankings/literacy-rate-by-country


# Appendix

```{r, echo=TRUE, eval=FALSE }
library(ggplot2)
setwd("~/Downloads")
data = read.csv("final_data.csv")

table(data$gni, data$literacy)

ggplot(data=data, aes(x = gni, y = percentDead, fill = gni)) + geom_boxplot() + ggtitle("Figure 1: Percentage Dead by GNI")

ggplot(data=data, aes(x = literacy, y = percentDead, fill = literacy)) + geom_boxplot() + ggtitle("Figure 2: Percentage Dead by Literacy Rate")

aov.fit = aov(data = data, percentDead ~ gni + literacy)
anova(aov.fit)

aov.fit2 = aov(data = data, percentDead ~ gni)
anova(aov.fit2)
par(mfrow=c(2,2))
plot(aov.fit2)
par(mfrow=c(1,1))

data$res.abs = abs(aov.fit2$residuals)
summary(aov(res.abs~percentDead, data=data))
```

